# åŸºäº Prompt æç¤ºå·¥ç¨‹çš„è¡Œäººé‡è¯†åˆ« (ReID)

æœ¬é¡¹ç›®æ¢ç´¢å¦‚ä½•åˆ©ç”¨å¤§è¯­è¨€æ¨¡å‹ (LLM) çš„æç¤ºå·¥ç¨‹ (Prompt Engineering) ä¸å¤šæ¨¡æ€æ¨¡å‹ (å¦‚ CLIP) ç»“åˆï¼Œæå‡è¡Œäººé‡è¯†åˆ« (Person Re-Identification, ReID) çš„æ£€ç´¢æ€§èƒ½ã€‚  
é€šè¿‡è®¾è®¡é«˜è´¨é‡çš„æç¤ºè¯ï¼Œç”Ÿæˆç»†ç²’åº¦çš„è¡Œäººæè¿°ä¸ç»“æ„åŒ–å±æ€§ï¼Œä½¿æ–‡æœ¬ç‰¹å¾ä¸å›¾åƒç‰¹å¾åœ¨å…±åŒç©ºé—´å¯¹é½ï¼Œä»è€Œæå‡è·¨æ¨¡æ€æ£€ç´¢çš„å‡†ç¡®ç‡ä¸å¯è§£é‡Šæ€§ã€‚

---

## ğŸ“‚ é¡¹ç›®ç»“æ„

```text
reid-prompt/
â”œâ”€ configs/        # ç¯å¢ƒä¸æµæ°´çº¿é…ç½®
â”œâ”€ data/           # æ•°æ®é›†ç›®å½•ï¼ˆéœ€æ‰‹åŠ¨ä¸‹è½½ï¼‰
â”‚  â”œâ”€ market1501/  # Market-1501 æ•°æ®é›†
â”‚  â”‚  â”œâ”€ query/
â”‚  â”‚  â”œâ”€ bounding_box_test/
â”‚  â”‚  â””â”€ bounding_box_train/
â”œâ”€ docs/           # æ–‡æ¡£ä¸å®éªŒè®°å½•
â”œâ”€ outputs/        # æ¨¡å‹è¾“å‡ºï¼ˆæè¿°ã€å±æ€§ã€ç‰¹å¾ã€ç»“æœï¼‰
â”œâ”€ prompts/        # æç¤ºè¯æ¨¡æ¿
â”œâ”€ scripts/        # å¯åŠ¨è„šæœ¬
â”œâ”€ src/            # æ ¸å¿ƒä»£ç 
â”‚  â”œâ”€ prepare_data.py
â”‚  â”œâ”€ gen_caption.py
â”‚  â”œâ”€ parse_attrs.py
â”‚  â”œâ”€ encode_clip.py
â”‚  â”œâ”€ retrieve.py
â”‚  â””â”€ eval_metrics.py
â””â”€ requirements.txt
````

---

## ğŸ“Š æ•°æ®é›†è¯´æ˜

* **Market-1501**ï¼ˆä¸»æ•°æ®é›†ï¼‰ï¼šåŒ…å« 1,501 ä¸ªè¡Œäººèº«ä»½ï¼Œ32,668 å¼ æ£€æµ‹æ¡†å›¾åƒã€‚
* åç»­å¯æ‰©å±•ï¼šDukeMTMC-reIDã€CUHK03ã€MSMT17ã€Occluded/Partial ReID ç­‰ï¼Œç”¨äºé²æ£’æ€§è¯„æµ‹ã€‚

æ•°æ®é›†æ”¾ç½®æ–¹å¼ï¼ˆä»¥ Market-1501 ä¸ºä¾‹ï¼‰ï¼š

```text
data/market1501/
â”œâ”€ query/
â”œâ”€ bounding_box_test/
â””â”€ bounding_box_train/
```

---

## âš™ï¸ ç¯å¢ƒä¾èµ–å®‰è£…

æ¨èä½¿ç”¨ **Python 3.10+** ä¸è™šæ‹Ÿç¯å¢ƒ (venv/conda)ã€‚

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv .venv
source .venv/bin/activate   # Linux / macOS
.venv\Scripts\activate      # Windows

# å‡çº§ pip
pip install -U pip

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

`requirements.txt` å»ºè®®åŒ…å«ï¼š

```txt
torch
torchvision
faiss-gpu
openai
transformers
tqdm
numpy
pandas
requests
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹ï¼ˆå°æ ·å†’çƒŸæµ‹è¯•ï¼‰

1. **å‡†å¤‡æ•°æ®**ï¼šä¸‹è½½å¹¶è§£å‹ Market-1501 æ•°æ®é›†åˆ° `data/market1501/`ã€‚
2. **å‡†å¤‡æç¤ºè¯**ï¼š

   * `prompts/base.txt`

     ```text
     è¯·è¯¦ç»†æè¿°å›¾åƒä¸­çš„è¡Œäººï¼Œåªæè¿°äººç‰©å¯è§å¤–è§‚ã€‚
     åŒ…æ‹¬æ€§åˆ«ã€ä¸Šè¡£ã€ä¸‹è£…ã€é‹å­ã€æ˜¯å¦èƒŒåŒ…ã€‚è‹¥æ— æ³•åˆ¤æ–­åˆ™å†™â€œæœªçŸ¥â€ï¼Œä¸è¦çŒœæµ‹ã€‚
     ä¸è¦æè¿°èƒŒæ™¯ã€‚
     ```
   * `prompts/json.txt`

     ```text
     è¯·ç”¨ JSON æ ¼å¼è¾“å‡ºè¯¥è¡Œäººçš„å±æ€§ï¼ŒåŒ…æ‹¬ï¼š
     gender, top_color, top_type, bottom_color, bottom_type, shoes_color, bag (true/false/æœªçŸ¥)ã€‚
     å¦‚æœæ— æ³•ç¡®å®šï¼Œå€¼å¡«â€œæœªçŸ¥â€ã€‚
     ```
3. **è¿è¡Œå¿«é€Ÿè„šæœ¬**ï¼š

   ```bash
   bash scripts/quick_start.sh
   ```
4. **æŸ¥çœ‹è¾“å‡º**ï¼š

   * æè¿°ç»“æœï¼š`outputs/captions/...`
   * å±æ€§ç»“æœï¼š`outputs/attrs/...`
   * ç‰¹å¾æ–‡ä»¶ï¼š`outputs/feats/...`
   * è¯„æµ‹æŒ‡æ ‡ä¸æŠ¥å‘Šï¼š`outputs/runs/...`

---

## ğŸ“ˆ è¯„æµ‹æŒ‡æ ‡

* **Rank-1**ï¼šTop-1 å‡†ç¡®ç‡
* **mAP**ï¼šå¹³å‡å‡†ç¡®ç‡
* å¯è§†åŒ–ï¼šCMC æ›²çº¿ã€æ£€ç´¢æ¡ˆä¾‹å±•ç¤º

---

## âœ¨ é¡¹ç›®ç›®æ ‡

* è®¾è®¡å¹¶éªŒè¯å¤šæ ·åŒ–æç¤ºè¯æ¨¡æ¿
* ç”Ÿæˆé«˜è´¨é‡è¡Œäººæè¿°ä¸ç»“æ„åŒ–å±æ€§
* ä¸ CLIP è·¨æ¨¡æ€ç¼–ç ç»“åˆï¼Œå®ç°æ–‡æœ¬â†’å›¾åƒæ£€ç´¢
* åœ¨æ ‡å‡†æŒ‡æ ‡ (Rank-1, mAP) ä¸Šå¯¹æ¯”åŸºçº¿å¹¶åˆ†ææ”¹è¿›æ•ˆæœ
* æä¾›ä¸€å¥—åŸºäº Prompt çš„å¯è§£é‡Š ReID å®éªŒæ¡†æ¶

---
